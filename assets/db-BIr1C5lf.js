const h={_get(e){try{return JSON.parse(localStorage.getItem("ngs_db_"+e)||"null")}catch{return null}},_set(e,s){localStorage.setItem("ngs_db_"+e,JSON.stringify(s))},getUsers(){return this._get("users")||[]},saveUsers(e){this._set("users",e)},addUser(e){const s=this.getUsers();return e.id="u_"+Date.now()+"_"+Math.random().toString(36).slice(2,6),e.createdAt=new Date().toISOString(),s.push(e),this.saveUsers(s),e},getUserByEmail(e){return this.getUsers().find(s=>s.email===e)},getChildren(){return this._get("children")||[]},saveChildren(e){this._set("children",e)},addChild(e){const s=this.getChildren();return e.id="ch_"+Date.now()+"_"+Math.random().toString(36).slice(2,6),e.createdAt=new Date().toISOString(),s.push(e),this.saveChildren(s),e},getChildrenByParent(e){return this.getChildren().filter(s=>s.parentId===e)},getChildByPin(e){return this.getChildren().find(s=>s.pin===e)},getPurchases(){return this._get("purchases")||[]},savePurchases(e){this._set("purchases",e)},addPurchase(e){const s=this.getPurchases();return e.id="pay_"+Date.now()+"_"+Math.random().toString(36).slice(2,6),e.date=new Date().toISOString(),s.push(e),this.savePurchases(s),this.logEvent("purchase",e),e},getPurchasesByUser(e){return this.getPurchases().filter(s=>s.userId===e)},hasCourseAccess(e,s){return this.getPurchasesByUser(e).some(a=>a.status==="success"&&(a.plan==="fullAccess"||a.plan==="familyPlan"||a.plan==="singleCourse"&&a.courseId===s))?!0:this.getUserCourseAccess(e).some(a=>a.courseId===s||a.courseId==="all")},getCourseAccess(){return this._get("course_access")||[]},saveCourseAccess(e){this._set("course_access",e)},grantCourseAccess(e,s,t,r){const i=this.getCourseAccess();i.push({id:"ca_"+Date.now(),userId:e,courseId:s,grantedBy:t,reason:r,grantedAt:new Date().toISOString(),active:!0}),this.saveCourseAccess(i),this.logEvent("course_access_granted",{userId:e,courseId:s,reason:r})},revokeCourseAccess(e){const s=this.getCourseAccess(),t=s.find(r=>r.id===e);t&&(t.active=!1,t.revokedAt=new Date().toISOString()),this.saveCourseAccess(s)},getUserCourseAccess(e){return this.getCourseAccess().filter(s=>s.userId===e&&s.active)},updateUser(e,s){const t=this.getUsers(),r=t.findIndex(i=>i.id===e);r>=0&&(Object.assign(t[r],s),this.saveUsers(t))},deactivateUser(e){this.updateUser(e,{active:!1,deactivatedAt:new Date().toISOString()}),this.logEvent("user_deactivated",{userId:e})},reactivateUser(e){this.updateUser(e,{active:!0}),this.logEvent("user_reactivated",{userId:e})},deleteUser(e){const s=this.getUsers().filter(r=>r.id!==e);this.saveUsers(s);const t=this.getChildren().filter(r=>r.parentId!==e);this.saveChildren(t),this.logEvent("user_deleted",{userId:e})},getProgress(){return this._get("progress")||{}},saveProgress(e){this._set("progress",e)},setChapterComplete(e,s,t){const r=this.getProgress();r[e]||(r[e]={}),r[e][`${s}_${t}`]={completedAt:new Date().toISOString()},this.saveProgress(r)},getChildProgress(e){return this.getProgress()[e]||{}},getEvents(){return this._get("events")||[]},logEvent(e,s){const t=this.getEvents();t.push({type:e,data:s,ts:new Date().toISOString()}),t.length>500&&t.splice(0,t.length-500),this._set("events",t)},getSettings(){return this._get("settings")||{demoMode:!0,pricing:{singleCourse:19,fullAccess:39,familyPlan:59},stripeKey:"YOUR_STRIPE_KEY",razorpayKey:"YOUR_RAZORPAY_KEY"}},saveSettings(e){this._set("settings",e)},seed(){if(this._get("seeded"))return;[{name:"Sarah Johnson",email:"sarah@demo.com",password:"demo123",children:[{name:"Emma",age:10,pin:"1234"},{name:"Liam",age:12,pin:"5678"}]},{name:"Priya Sharma",email:"priya@demo.com",password:"demo123",children:[{name:"Arjun",age:11,pin:"1111"},{name:"Ananya",age:9,pin:"2222"}]},{name:"Mike Chen",email:"mike@demo.com",password:"demo123",children:[{name:"Lucas",age:13,pin:"3333"},{name:"Mia",age:10,pin:"4444"}]}].forEach(s=>{const t=this.addUser({name:s.name,email:s.email,password:s.password,role:"parent"});s.children.forEach(r=>{const i=this.addChild({name:r.name,age:r.age,pin:r.pin,parentId:t.id}),c=["ai","space","robotics"][Math.floor(Math.random()*3)],o=Math.floor(Math.random()*4)+1;for(let n=0;n<o;n++)this.setChapterComplete(i.id,c,n)}),s.email==="sarah@demo.com"&&this.addPurchase({userId:t.id,plan:"fullAccess",amount:39,currency:"USD",status:"success",method:"stripe"}),s.email==="priya@demo.com"&&(this.addPurchase({userId:t.id,plan:"singleCourse",courseId:"ai",amount:19,currency:"USD",status:"success",method:"razorpay"}),this.addPurchase({userId:t.id,plan:"singleCourse",courseId:"space",amount:19,currency:"USD",status:"failed",method:"razorpay"}))}),this._set("seeded",!0)}};h.seed();export{h as default};
